#!/bin/sh

# wifi-monitor v5.2
# Bruno "GNUser" Dantas GPLv3

# user variables:
iface=wlan0
icon=/path/to/wifi.png
canvas=systray # choose either systray (most users) or wbar

main()
{
	while true; do
		if curl --silent --max-time 5 --head http://duckduckgo.com >/dev/null; then
			ssid="$(iwconfig $iface | grep ESSID | awk -F\" '{print $2}')"
			icon_add
		else
			icon_remove
		fi
		sleep 10
	done
}

icon_add()
{
	if [ "$canvas" = "systray" ]; then
		pgrep -f "yad.*${icon}" >/dev/null && return
		yad --notification --image="$icon" --icon-size=24 --text="$ssid" --command=true &
	elif [ "$canvas" = "wbar" ]; then
		grep -q "$icon" "$wbar_config_file" && return
		printf "i: $icon\nt: $ssid\nc: true\n" >> $wbar_config_file
		pkill wbar && wbar >/dev/null 2>&1 &
	fi
}

icon_remove()
{
	if [ "$canvas" = "systray" ]; then
		pgrep -f "yad.*${icon}" >/dev/null || return
		pkill -f "yad.*${icon}"
	elif [ "$canvas" = "wbar" ]; then
		grep -q "$icon" "$wbar_config_file" || return
		sed -i "\|$icon|,+2 d" $wbar_config_file
		pkill wbar && wbar >/dev/null 2>&1 &
	fi
}

# internal variables:
wbar_config_file=$HOME/.wbar

main
