#!/bin/sh

# wifi-monitor v7.0
# Bruno "GNUser" Dantas GPLv3

# user variables:
iface=wlan0
icon=/opt/scripts/media/wifi.png

main()
{
	while true; do
		if curl --silent --max-time 10 --head http://duckduckgo.com >/dev/null; then
			ssid="$(iwconfig $iface | grep ESSID | awk -F\" '{print $2}')"
			icon_add "$icon" "$ssid"
		else
			icon_remove "$icon"
		fi
		sleep 10
	done
}

icon_add()
{
	pgrep -f "mktrayicon.*$1" >/dev/null && return
	mktrayicon -i "$1" -t "$2" &
}

icon_remove()
{
	pgrep -f "mktrayicon.*$1" >/dev/null || return
	pkill -f "mktrayicon.*$1"
}

main
